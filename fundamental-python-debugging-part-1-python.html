<!DOCTYPE html>

<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1FZ91XSPCR"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1FZ91XSPCR');
    </script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Pelican" name="generator"/>
<meta content="Will Ayd Blog Posts" name="description"/>
<title>Fundamental Python Debugging Part 1 - Python</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" rel="stylesheet"/>
<link href="https://willayd.com/theme/css/main.css" rel="stylesheet" type="text/css"/>
<link href="https://willayd.com/theme/css/pygment.css" rel="stylesheet" type="text/css"/>
<link href="https://willayd.com/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="https://willayd.com/theme/css/stork.css" rel="stylesheet"/>
<link href="https://willayd.com/theme/css/stork-dark.css" media="screen and (prefers-color-scheme: dark)" rel="stylesheet"/>
<link href="https://willayd.com/css/custom.css" rel="stylesheet"/>
<link href="https://willayd.com/feeds/all.atom.xml" rel="alternate" title="Will Ayd Atom Feed" type="application/atom+xml">
</link><link href="https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Will Ayd", "item": "https://willayd.com"}, {"@type": "ListItem", "position": 2, "name": "Fundamental python debugging part 1 python", "item": "https://willayd.com/fundamental-python-debugging-part-1-python.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Will Ayd"}, "publisher": {"@type": "Organization", "name": "Will Ayd"}, "headline": "Fundamental Python Debugging Part 1 - Python", "about": "debugging", "datePublished": "2023-02-08 00:00", "image": "https://willayd.com/images/og_logo.png"}</script><meta content="summary" name="twitter:card"/><meta content="https://willayd.com/fundamental-python-debugging-part-1-python.html" property="og:url"/><meta content="article" property="og:type"/><meta content="Fundamental Python Debugging Part 1 - Python" property="og:title"/><meta content="This article shows you how to use pdb to debug Python applications. pdb offers a lot of hidden functionality and helps you learn debuggers for other languages." property="og:description"/><meta content="https://willayd.com/images/og_logo.png" property="og:image"/><meta content="en_US" property="og:locale"/></head>
<body class="min-h-screen flex flex-col max-w-7xl lg:max-w-none text-zinc-800 bg-neutral-100 dark:bg-neutral-900 dark:text-zinc-300 container mx-auto justify-center md:px-3">
<script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
<nav class="sm:flex sm:justify-between xl:ml-32 pl-4 items-center">
<div class="flex pt-4">
<h2 class="font-semibold text-2xl"><a href="https://willayd.com/">Will Ayd</a></h2>
<button aria-label="Light|Dark" class="text-zinc-700 dark:text-zinc-400 rounded-full focus:outline-none text-sm ml-2 p-1" id="theme-toggle" type="button">
<svg class="w-5 h-5 hidden" fill="currentColor" id="theme-toggle-dark-icon" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
</svg>
<svg class="w-5 h-5 hidden" fill="currentColor" id="theme-toggle-light-icon" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd"></path>
</svg>
</button>
</div>
<ul class="flex flex-wrap lg:mr-24 md:pt-0">
<li class="mr-4 pt-6"><a href="https://willayd.com/archives.html">Archive</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/categories.html">Categories</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/tags.html">Tags</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/search.html">Search</a></li>
</ul>
</nav>
<div class="flex-grow md:max-w-screen-md md:mx-auto md:w-3/4 px-4">
<nav aria-label="Breadcrumb" class="text-zinc-800 dark:text-zinc-300 mt-12 pb-2 md:mt-16">
<ul class="p-0 inline-flex items-center">
<li class="flex items-center">
<a class="text-zinc-800 dark:text-zinc-300 inline-flex items-center" href="https://willayd.com/">
<svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
</path>
</svg>
                        Home
                    </a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
<li class="flex items-center">
<a href="https://willayd.com/categories.html">Categories</a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
<li class="flex items-center">
<a href="https://willayd.com/category/debugging.html">debugging</a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
</ul>
</nav>
<main>
<header>
<h1 class="font-semibold text-3xl my-2">Fundamental Python Debugging Part 1 - Python</h1>
<footer class="flex text-sm text-zinc-800 dark:text-zinc-400">
<div class="flex text-xs text-zinc-800 dark:text-zinc-400">
<time>February 08, 2023</time>
<div>
<span> · 23 min read</span>
</div>
<div>
<span> · Will Ayd</span>
</div>
</div>
</footer>
</header>
<details class="flex flex-col my-6 p-4 bg-zinc-200 dark:bg-zinc-800 rounded-lg">
<summary class="text-lg font-bold">Table of contents</summary>
<div class="mx-4 px-4 underline">
<div id="toc"><ul><li><a class="toc-href" href="#setting-up-your-example" title="Setting up your example">Setting up your example</a></li><li><a class="toc-href" href="#part-1-debugging-exceptions" title="Part 1: Debugging exceptions">Part 1: Debugging exceptions</a></li><li><a class="toc-href" href="#part-2-debugging-logical-errors" title="Part 2: Debugging logical errors">Part 2: Debugging logical errors</a></li><li><a class="toc-href" href="#closing-thoughts" title="Closing Thoughts">Closing Thoughts</a></li></ul></div>
</div>
</details>
<div class="max-w-7xl container mx-auto my-8 text-zinc-800 dark:text-zinc-300 prose lg:max-w-none prose-headings:text-zinc-800 prose-headings:dark:text-zinc-300 prose-h1:text-3xl lg:prose-h1:text-3xl prose-headings:font-semibold prose-pre:bg-zinc-200 prose-pre:text-zinc-800 dark:prose-pre:bg-zinc-800 dark:prose-pre:text-zinc-200 prose-blockquote:text-zinc-800 dark:prose-blockquote:text-zinc-200 prose-a:text-slate-600 prose-a:font-normal dark:prose-a:text-slate-400 dark:prose-strong:text-zinc-200 dark:prose-code:text-zinc-200 dark:prose-code:bg-zinc-800 prose-code:bg-zinc-200 prose-code:font-light prose-img:rounded-md sm:text-left md:text-justify">
<p>The topic of debugging Python is well-covered. Regardless of whether you want to use your IDE interactively or work from a console with <a class="reference external" href="https://docs.python.org/3/library/pdb.html">pdb</a>, chances are this is not the first article you have read on the topic.</p>
<p>In spite of the wealth of content, I've found that most articles on debugging Python are singularly focused on <em>debugging Python</em>. That may not seem like such a bad thing at face value, but developing Python at an advanced level requires not only knowledge of the language itself, but also of lower level languages like C/C++. Being an expert in all of these languages at one time is near impossible, so knowing how to debug them effectively is critical.</p>
<p>Luckily, when viewed through the proper lens, there is a lot of overlap in the debugging tooling for these languages. The built-in Python pdb debugger borrows much of its utility from <a class="reference external" href="https://sourceware.org/gdb/">gdb</a>, which will help you debug C/C++/Rust/Fortran, etc... gdb itself is extendable <a class="reference external" href="https://sourceware.org/gdb/onlinedocs/gdb/Python.html#Python">using Python</a>, and this extensibility is the reason why things like the <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/debugging.html">Cython debugger</a> exist.</p>
<p>Few if any other articles on debugging Python applications touch on these synchronicities. This and my next few blog posts attempt to highlight this for you and help you seamlessly transition across the aforementioned tools.</p>
<div class="section" id="setting-up-your-example">
<h2 id="setting-up-your-example">Setting up your example</h2>
<p>Let's start with a buggy script. This code isn't <em>pythonic</em> and you may be able to troubleshoot without even using a debugger, but that isn't important for this exercise. Go ahead and save the below snippet as <tt class="docutils literal">buggy_program.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">buggy_loop</span><span class="p">():</span>
    <span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"dog"</span><span class="p">,</span> <span class="s2">"cat"</span><span class="p">,</span> <span class="s2">"turtle"</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The animal at index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">animals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">buggy_loop</span><span class="p">()</span>
</pre></div>
<p>Executing this program with <tt class="docutils literal">python buggy_program.py</tt> should yield:</p>
<div class="highlight"><pre><span></span>The animal at index <span class="m">0</span> is dog
The animal at index <span class="m">1</span> is cat
The animal at index <span class="m">2</span> is turtle
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"buggy_program.py"</span>, line <span class="m">10</span>, <span class="k">in</span> &lt;module&gt;
    buggy_loop<span class="o">()</span>
  File <span class="s2">"buggy_program.py"</span>, line <span class="m">6</span>, <span class="k">in</span> buggy_loop
    print<span class="o">(</span>f<span class="s2">"The animal at index {index} is {animals[index]}"</span><span class="o">)</span>
IndexError: list index out of range
</pre></div>
</div>
<div class="section" id="part-1-debugging-exceptions">
<h2 id="part-1-debugging-exceptions">Part 1: Debugging exceptions</h2>
<p>Changing our command from <tt class="docutils literal">python buggy_script.py</tt> to <tt class="docutils literal">python <span class="pre">-m</span> pdb buggy_script.py</tt> will launch pdb and load the script. pdb will not immediately execute anything, but instead wait for your input. We assume we don't know any commands yet, so typing <tt class="docutils literal">help</tt> is the best thing for us to start with</p>
<div class="highlight"><pre><span></span>&gt; /home/willayd/buggy_program.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def buggy_loop<span class="o">()</span>:
<span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">help</span>

Documented commands <span class="o">(</span><span class="nb">type</span> <span class="nb">help</span> &lt;topic&gt;<span class="o">)</span>:
<span class="o">========================================</span>
EOF    c          d        h         list      q        rv       undisplay
a      cl         debug    <span class="nb">help</span>      ll        quit     s        unt
<span class="nb">alias</span>  clear      disable  ignore    longlist  r        <span class="nb">source</span>   <span class="k">until</span>
args   commands   display  interact  n         restart  step     up
b      condition  down     j         next      <span class="k">return</span>   tbreak   w
<span class="nb">break</span>  cont       <span class="nb">enable</span>   jump      p         retval   u        whatis
bt     <span class="k">continue</span>   <span class="nb">exit</span>     l         pp        run      <span class="nb">unalias</span>  where

Miscellaneous <span class="nb">help</span> topics:
<span class="o">==========================</span>
<span class="nb">exec</span>  pdb
</pre></div>
<p><tt class="docutils literal">help &lt;topic&gt;</tt> allows you to navigate any of the items listed above. We can even input <tt class="docutils literal">help help</tt> as a meta-command.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">help</span> <span class="nb">help</span>
h<span class="o">(</span>elp<span class="o">)</span>
        Without argument, print the list of available commands.
        With a <span class="nb">command</span> name as argument, print <span class="nb">help</span> about that command.
        <span class="s2">"help pdb"</span> shows the full pdb documentation.
        <span class="s2">"help exec"</span> gives <span class="nb">help</span> on the ! command.
</pre></div>
<p>The <tt class="docutils literal">help</tt> we have input so far is a pdb command and not the built-in <tt class="docutils literal">help</tt> function that Python provides. If you wanted to execute the latter, you should prefix your input with <tt class="docutils literal">!</tt>:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> !help<span class="o">()</span>

Welcome to Python <span class="m">3</span>.8<span class="err">'</span>s <span class="nb">help</span> utility!

If this is your first <span class="nb">time</span> using Python, you should definitely check out
the tutorial on the Internet at https://docs.python.org/3.8/tutorial/.

Enter the name of any module, keyword, or topic to get <span class="nb">help</span> on writing
Python programs and using Python modules.  To quit this <span class="nb">help</span> utility and
<span class="k">return</span> to the interpreter, just <span class="nb">type</span> <span class="s2">"quit"</span>.

To get a list of available modules, keywords, symbols, or topics, <span class="nb">type</span>
<span class="s2">"modules"</span>, <span class="s2">"keywords"</span>, <span class="s2">"symbols"</span>, or <span class="s2">"topics"</span>.  Each module also comes
with a one-line summary of what it does<span class="p">;</span> to list the modules whose name
or summary contain a given string such as <span class="s2">"spam"</span>, <span class="nb">type</span> <span class="s2">"modules spam"</span>.
</pre></div>
<p>If you executed the above <tt class="docutils literal">!help()</tt> command be sure to input <tt class="docutils literal">q</tt> and hit enter to quit the Python interactive help.</p>
<p>To actually get code executing we want to <tt class="docutils literal">continue</tt>. <tt class="docutils literal">help continue</tt> shows us more about this command.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">help</span> c
c<span class="o">(</span>ont<span class="o">(</span>inue<span class="o">))</span>
        Continue execution, only stop when a breakpoint is encountered.
</pre></div>
<p>So <tt class="docutils literal">c</tt>, <tt class="docutils literal">cont</tt>, and <tt class="docutils literal">continue</tt> would all do the same things for us. For now input <tt class="docutils literal">c</tt> and press enter:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> c
The animal at index <span class="m">0</span> is dog
The animal at index <span class="m">1</span> is cat
The animal at index <span class="m">2</span> is turtle
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/usr/lib/python3.10/pdb.py"</span>, line <span class="m">1726</span>, <span class="k">in</span> main
    pdb._runscript<span class="o">(</span>mainpyfile<span class="o">)</span>
  File <span class="s2">"/usr/lib/python3.10/pdb.py"</span>, line <span class="m">1586</span>, <span class="k">in</span> _runscript
    self.run<span class="o">(</span>statement<span class="o">)</span>
  File <span class="s2">"/usr/lib/python3.10/bdb.py"</span>, line <span class="m">597</span>, <span class="k">in</span> run
    exec<span class="o">(</span>cmd, globals, locals<span class="o">)</span>
  File <span class="s2">"&lt;string&gt;"</span>, line <span class="m">1</span>, <span class="k">in</span> &lt;module&gt;
  File <span class="s2">"/home/willayd/buggy_program.py"</span>, line <span class="m">10</span>, <span class="k">in</span> &lt;module&gt;
    buggy_loop<span class="o">()</span>
  File <span class="s2">"/home/willayd/buggy_program.py"</span>, line <span class="m">6</span>, <span class="k">in</span> buggy_loop
    print<span class="o">(</span>f<span class="s2">"The animal at index {index} is {animals[index]}"</span><span class="o">)</span>
IndexError: list index out of range
Uncaught exception. Entering post mortem debugging
Running <span class="s1">'cont'</span> or <span class="s1">'step'</span> will restart the program
&gt; /home/willayd/buggy_program.py<span class="o">(</span><span class="m">6</span><span class="o">)</span>buggy_loop<span class="o">()</span>
-&gt; print<span class="o">(</span>f<span class="s2">"The animal at index {index} is {animals[index]}"</span><span class="o">)</span>
<span class="o">(</span>pdb<span class="o">)</span>
</pre></div>
<p>The program has executed and printed the same traceback we saw without using pdb. However, since we are running our script under pdb execution halts after an error occurs and allows us to inspect the state of the program.</p>
<p><tt class="docutils literal">l</tt> (short for list) shows us where the execution halted (see <cite>-&gt;</cite> below) and a few lines around that.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> l
  <span class="m">1</span>          def buggy_loop<span class="o">()</span>:
  <span class="m">2</span>              <span class="nv">animals</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"dog"</span>, <span class="s2">"cat"</span>, <span class="s2">"turtle"</span><span class="o">]</span>
  <span class="m">3</span>              <span class="nv">index</span> <span class="o">=</span> <span class="m">0</span>
  <span class="m">4</span>
  <span class="m">5</span>              <span class="k">while</span> index &lt;<span class="o">=</span> len<span class="o">(</span>animals<span class="o">)</span>:
  <span class="m">6</span>  -&gt;              print<span class="o">(</span>f<span class="s2">"The animal at index {index} is {animals[index]}"</span><span class="o">)</span>
  <span class="m">7</span>                  <span class="nv">index</span> <span class="o">+=</span> <span class="m">1</span>
  <span class="m">8</span>
  <span class="m">9</span>          <span class="k">if</span> <span class="nv">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span>:
 <span class="m">10</span>              buggy_loop<span class="o">()</span>
<span class="o">[</span>EOF<span class="o">]</span>
</pre></div>
<p>Typing <tt class="docutils literal">l</tt> again interestingly does not give us the same result:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> l
<span class="o">[</span>EOF<span class="o">]</span>
</pre></div>
<p><tt class="docutils literal">list</tt> automatically iterates through the code every time the command is entered, and because our script is small we just reach the end-of-file. To continually display where execution halted you can enter <tt class="docutils literal">l .</tt>.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> l .
  <span class="m">1</span>          def buggy_loop<span class="o">()</span>:
  <span class="m">2</span>              <span class="nv">animals</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"dog"</span>, <span class="s2">"cat"</span>, <span class="s2">"turtle"</span><span class="o">]</span>
  <span class="m">3</span>              <span class="nv">index</span> <span class="o">=</span> <span class="m">0</span>
  <span class="m">4</span>
  <span class="m">5</span>              <span class="k">while</span> index &lt;<span class="o">=</span> len<span class="o">(</span>animals<span class="o">)</span>:
  <span class="m">6</span>  -&gt;              print<span class="o">(</span>f<span class="s2">"The animal at index {index} is {animals[index]}"</span><span class="o">)</span>
  <span class="m">7</span>                  <span class="nv">index</span> <span class="o">+=</span> <span class="m">1</span>
  <span class="m">8</span>
  <span class="m">9</span>          <span class="k">if</span> <span class="nv">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span>:
 <span class="m">10</span>              buggy_loop<span class="o">()</span>
<span class="o">[</span>EOF<span class="o">]</span>
</pre></div>
<p>Another nice feature of pdb is that you can enter expressions see the result printed back. For instance, we know we have a variable named <tt class="docutils literal">index</tt> in the function we are debugging, so entering that into pdb will print the value of index.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> index
<span class="m">3</span>
</pre></div>
<p>If you are debugging a longer function with a lot of variables, you may also be interested in the <tt class="docutils literal">dir()</tt> or <tt class="docutils literal">locals()</tt> functions. The former shows the names of all variables in the current scope; the latter gives you the names and values.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> dir<span class="o">()</span>
<span class="o">[</span><span class="s1">'animals'</span>, <span class="s1">'index'</span><span class="o">]</span>
<span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'animals'</span>: <span class="o">[</span><span class="s1">'dog'</span>, <span class="s1">'cat'</span>, <span class="s1">'turtle'</span><span class="o">]</span>, <span class="s1">'index'</span>: <span class="m">3</span><span class="o">}</span>
</pre></div>
<p>Let us step back now and talk about the problem we are trying to solve. The traceback tells us we have an <tt class="docutils literal">IndexError: list index out of range</tt> on line 6, and the debugger paused us at that same line. Upon inspecting the <tt class="docutils literal">index</tt> variable in the debugger we note it has a value of 3.</p>
<p>Line 6 attempts to do <tt class="docutils literal">animals[index]</tt>, which fails because Python is a 0-based index language. One fix is for us to change line 5 from</p>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">):</span>
</pre></div>
<p>to</p>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">):</span>
</pre></div>
<p>If you make that change to the source code you can enter <tt class="docutils literal">restart</tt> into pdb to start over with the updated script logic. From there input <tt class="docutils literal">c</tt> and you will note the script executes without issue.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> restart
Restarting /home/willayd/buggy_program.py with arguments:

&gt; /home/willayd/buggy_program.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def buggy_loop<span class="o">()</span>:
<span class="o">(</span>Pdb<span class="o">)</span> c
Post mortem debugger finished. The /home/willayd/buggy_program.py will be restarted
&gt; /home/willayd/buggy_program.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def buggy_loop<span class="o">()</span>:
<span class="o">(</span>Pdb<span class="o">)</span> c
The animal at index <span class="m">0</span> is dog
The animal at index <span class="m">1</span> is cat
The animal at index <span class="m">2</span> is turtle
The program finished and will be restarted
&gt; /home/willayd/buggy_program.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def buggy_loop<span class="o">()</span>:
</pre></div>
<p>Since things are good to go now, you can type <tt class="docutils literal">quit()</tt> into the debugger to close things out.</p>
</div>
<div class="section" id="part-2-debugging-logical-errors">
<h2 id="part-2-debugging-logical-errors">Part 2: Debugging logical errors</h2>
<p>Getting an exception in Python is a clear indicator that things are wrong, but not every bug shows up as an error. The code below is inspired by pandas bug [#49861](<a class="reference external" href="https://github.com/pandas-dev/pandas/issues/49861">https://github.com/pandas-dev/pandas/issues/49861</a>). The code as originally written used a recursive function call that was roughly equivalent to:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize_json</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">key_string</span><span class="p">,</span>
    <span class="n">normalized_dict</span><span class="p">,</span>
    <span class="n">separator</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key_string</span><span class="si">}{</span><span class="n">separator</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">normalize_json</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="c1"># to avoid adding the separator to the start of every key</span>
                <span class="n">key_string</span><span class="o">=</span><span class="n">new_key</span>
                <span class="k">if</span> <span class="n">new_key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">separator</span>
                <span class="k">else</span> <span class="n">new_key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span> <span class="p">:],</span>
                <span class="n">normalized_dict</span><span class="o">=</span><span class="n">normalized_dict</span><span class="p">,</span>
                <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalized_dict</span><span class="p">[</span><span class="n">key_string</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">normalized_dict</span>
</pre></div>
<p>This function aims to take the keys of deeply nested dictionaries and combine them into one key with a separator. Note below how hierarchies like <tt class="docutils literal">a <span class="pre">-&gt;</span> b <span class="pre">-&gt;</span> c</tt> get folded into one <tt class="docutils literal">a.b.c</tt> key.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">normalize_json</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}},</span> <span class="s2">""</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"."</span><span class="p">)</span>
<span class="p">{</span><span class="s1">'a.b'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">normalize_json</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}}},</span> <span class="s2">""</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"."</span><span class="p">)</span>
<span class="p">{</span><span class="s1">'a.b.c'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
</pre></div>
<p>The OP of the pandas issue noticed that the function would incorrectly remove the start of the string at the top of the dictionary hierarchy _if_ that key began with the <tt class="docutils literal">separator</tt> argument. For instance, if you had a key at the top of the dictionary that began with an underscore and you used an underscore separator, the very first key would get mangled. This is visible below as the normalized key is shown as <tt class="docutils literal">a_b</tt> when it should be <tt class="docutils literal">_a_b</tt>.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">normalize_json</span><span class="p">({</span><span class="s2">"_a"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}},</span> <span class="s2">""</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"_"</span><span class="p">)</span>
<span class="p">{</span><span class="s1">'a_b'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
</pre></div>
<p>To diagnose, go ahead and save the following code as <tt class="docutils literal">buggy_script2.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize_json</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">key_string</span><span class="p">,</span>
    <span class="n">normalized_dict</span><span class="p">,</span>
    <span class="n">separator</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key_string</span><span class="si">}{</span><span class="n">separator</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">normalize_json</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="c1"># to avoid adding the separator to the start of every key</span>
                <span class="n">key_string</span><span class="o">=</span><span class="n">new_key</span>
                <span class="k">if</span> <span class="n">new_key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">separator</span>
                <span class="k">else</span> <span class="n">new_key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span> <span class="p">:],</span>
                <span class="n">normalized_dict</span><span class="o">=</span><span class="n">normalized_dict</span><span class="p">,</span>
                <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalized_dict</span><span class="p">[</span><span class="n">key_string</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">normalized_dict</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">normalize_json</span><span class="p">({</span><span class="s2">"_a"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}},</span> <span class="s2">""</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"_"</span><span class="p">))</span>
</pre></div>
<p>We can start the debugger and load the script using <tt class="docutils literal">python <span class="pre">-m</span> pdb buggy_script2.py</tt>. However, since there is no bug this time the code will not stop unless we explicitly set a <em>breakpoint</em>. <tt class="docutils literal">help break</tt> gives you some ideas on how to do this; for now start with <tt class="docutils literal">break normalize_json</tt></p>
<div class="highlight"><pre><span></span>&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def normalize_json<span class="o">(</span>
<span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">break</span> normalize_json
Breakpoint <span class="m">1</span> at /home/willayd/buggy_script2.py:1
<span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">break</span>
Num Type         Disp Enb   Where
<span class="m">1</span>   breakpoint   keep yes   at /home/willayd/buggy_script2.py:1
</pre></div>
<p>Continue along by hitting <tt class="docutils literal">c</tt> then <tt class="docutils literal">l</tt> to list where execution paused, and you will see it is the first line of the <tt class="docutils literal">normalize_json</tt> function</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> c
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> l
  <span class="m">2</span>              data,
  <span class="m">3</span>              key_string,
  <span class="m">4</span>              normalized_dict,
  <span class="m">5</span>              separator
  <span class="m">6</span>          <span class="o">)</span>:
  <span class="m">7</span>  -&gt;          <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
  <span class="m">8</span>                  <span class="k">for</span> key, value <span class="k">in</span> data.items<span class="o">()</span>:
  <span class="m">9</span>                      <span class="nv">new_key</span> <span class="o">=</span> f<span class="s2">"{key_string}{separator}{key}"</span>
 <span class="m">10</span>                      normalize_json<span class="o">(</span>
 <span class="m">11</span>                          <span class="nv">data</span><span class="o">=</span>value,
 <span class="m">12</span>                          <span class="c1"># to avoid adding the separator to the start of every key</span>
</pre></div>
<p>Another command worth introducing here is <tt class="docutils literal">backtrace</tt>, or <tt class="docutils literal">bt</tt> for short. Python functions operate as a [call stack](<a class="reference external" href="https://en.wikipedia.org/wiki/Call_stack">https://en.wikipedia.org/wiki/Call_stack</a>), so backtrace tells you the sequence of calls that lead up to the breakpoint.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> bt
  /usr/lib/python3.10/bdb.py<span class="o">(</span><span class="m">597</span><span class="o">)</span>run<span class="o">()</span>
-&gt; exec<span class="o">(</span>cmd, globals, locals<span class="o">)</span>
  &lt;string&gt;<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">25</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; normalize_json<span class="o">({</span><span class="s2">"_a"</span>: <span class="o">{</span><span class="s2">"b"</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}}</span>, <span class="s2">""</span>, <span class="o">{}</span>, <span class="s2">"_"</span><span class="o">)</span>
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
</pre></div>
<p>Within pdb the most recent call appears on the bottom (other debuggers may reverse this), so reading from the bottom up we are at <tt class="docutils literal">normalize_json</tt> line 7 which was called by our <tt class="docutils literal">buggy_script2.py</tt> script on line 25. The calls preceding that are internal to Python. Hit <tt class="docutils literal">c</tt> again and another <tt class="docutils literal">bt</tt> to see what happens next:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> c
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> bt
  /usr/lib/python3.10/bdb.py<span class="o">(</span><span class="m">597</span><span class="o">)</span>run<span class="o">()</span>
-&gt; exec<span class="o">(</span>cmd, globals, locals<span class="o">)</span>
  &lt;string&gt;<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">25</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; normalize_json<span class="o">({</span><span class="s2">"_a"</span>: <span class="o">{</span><span class="s2">"b"</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}}</span>, <span class="s2">""</span>, <span class="o">{}</span>, <span class="s2">"_"</span><span class="o">)</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">10</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; normalize_json<span class="o">(</span>
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
</pre></div>
<p>We are in a recursive function call, so we see that <tt class="docutils literal">normalize_json</tt> is at the bottom of our backtrace twice. This pattern would continue every time we continue script execution.</p>
<p>pdb let's you move up and down the stack trace. We know we are 2 <tt class="docutils literal">normalize_json</tt> calls deep. The <tt class="docutils literal">up</tt> and <tt class="docutils literal">down</tt> commands not surprisingly move up and down the call stack trace, giving you the power to inspect each <em>frame</em>.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}</span>, <span class="s1">'key_string'</span>: <span class="s1">'_a'</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span> up
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">10</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; normalize_json<span class="o">(</span>
<span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">{</span><span class="s1">'_a'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}}</span>, <span class="s1">'key_string'</span>: <span class="s1">''</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span>, <span class="s1">'key'</span>: <span class="s1">'_a'</span>, <span class="s1">'value'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}</span>, <span class="s1">'new_key'</span>: <span class="s1">'__a'</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span> down
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}</span>, <span class="s1">'key_string'</span>: <span class="s1">'_a'</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span><span class="o">}</span>
</pre></div>
<p>The first time we called <tt class="docutils literal">locals()</tt> we were at the most recent <tt class="docutils literal">normalize_json</tt> call. The <tt class="docutils literal">up</tt> command moved us back one frame; <tt class="docutils literal">down</tt> takes us back to the current frame.</p>
<p>Since our input data isn't too deeply nested, we could keep continuing and moving up and down the stack to try and find where the issue appears, but this could be impractical with many layers of recursion. Fortunately we can be more intelligent with where and when we choose to pause code execution.</p>
<p>To do that let's <tt class="docutils literal">restart</tt> our code execution and <tt class="docutils literal">clear</tt> our existing breakpoint(s).</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> restart
Restarting /home/willayd/buggy_script2.py with arguments:

&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def normalize_json<span class="o">(</span>
<span class="o">(</span>Pdb<span class="o">)</span> clear
Clear all breaks? y
Deleted breakpoint <span class="m">1</span> at /home/willayd/buggy_script2.py:1
</pre></div>
<p>If you inspected the <tt class="docutils literal">help break</tt> output earlier, you might have noticed that <tt class="docutils literal">break</tt> takes an optional condition argument. This is an expression that must evaluate to <tt class="docutils literal">True</tt> for the breakpoint to pause execution.</p>
<p>We know from our bug report and from inspecting some of the <tt class="docutils literal">locals()</tt> outputs earlier that the bug likely happens when a variable named <tt class="docutils literal">key_string</tt> has the value of <tt class="docutils literal">a_b</tt>, so we can pause execution <em>only</em> when that condition is met.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">break</span> normalize_json, <span class="nv">key_string</span> <span class="o">==</span> <span class="s2">"a_b"</span>
Breakpoint <span class="m">2</span> at /home/willayd/buggy_script2.py:1
<span class="o">(</span>Pdb<span class="o">)</span> c
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> bt
  /usr/lib/python3.10/bdb.py<span class="o">(</span><span class="m">597</span><span class="o">)</span>run<span class="o">()</span>
-&gt; exec<span class="o">(</span>cmd, globals, locals<span class="o">)</span>
  &lt;string&gt;<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">25</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; print<span class="o">(</span>normalize_json<span class="o">({</span><span class="s2">"_a"</span>: <span class="o">{</span><span class="s2">"b"</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}}</span>, <span class="s2">""</span>, <span class="o">{}</span>, <span class="s2">"_"</span><span class="o">))</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">10</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; normalize_json<span class="o">(</span>
  /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">10</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; normalize_json<span class="o">(</span>
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
</pre></div>
<p>The above backtrace shows us pausing code execution within the third call of <tt class="docutils literal">normalize_json</tt>. Even though our breakpoint was on the <tt class="docutils literal">normalize_json</tt> function, the expression <tt class="docutils literal">key_string == "a_b"</tt> did not evaluate to true for the first two function calls.</p>
<p>Where our execution paused <tt class="docutils literal">key_string</tt> is not modified locally, but rather received as an argument. This means the bug may surface up one call in the backtrace, so move up and inspect the code:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> u
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">10</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; normalize_json<span class="o">(</span>
<span class="o">(</span>Pdb<span class="o">)</span> ll
  <span class="m">1</span> B        def normalize_json<span class="o">(</span>
  <span class="m">2</span>              data,
  <span class="m">3</span>              key_string,
  <span class="m">4</span>              normalized_dict,
  <span class="m">5</span>              separator
  <span class="m">6</span>          <span class="o">)</span>:
  <span class="m">7</span>              <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
  <span class="m">8</span>                  <span class="k">for</span> key, value <span class="k">in</span> data.items<span class="o">()</span>:
  <span class="m">9</span>                      <span class="nv">new_key</span> <span class="o">=</span> f<span class="s2">"{key_string}{separator}{key}"</span>
 <span class="m">10</span>  -&gt;                  normalize_json<span class="o">(</span>
 <span class="m">11</span>                          <span class="nv">data</span><span class="o">=</span>value,
 <span class="m">12</span>                          <span class="c1"># to avoid adding the separator to the start of every key</span>
 <span class="m">13</span>                          <span class="nv">key_string</span><span class="o">=</span>new_key
 <span class="m">14</span>                          <span class="k">if</span> new_key<span class="o">[</span>len<span class="o">(</span>separator<span class="o">)</span> - <span class="m">1</span><span class="o">]</span> !<span class="o">=</span> separator
 <span class="m">15</span>                          <span class="k">else</span> new_key<span class="o">[</span>len<span class="o">(</span>separator<span class="o">)</span> :<span class="o">]</span>,
 <span class="m">16</span>                          <span class="nv">normalized_dict</span><span class="o">=</span>normalized_dict,
 <span class="m">17</span>                          <span class="nv">separator</span><span class="o">=</span>separator,
 <span class="m">18</span>                      <span class="o">)</span>
 <span class="m">19</span>              <span class="k">else</span>:
 <span class="m">20</span>                  normalized_dict<span class="o">[</span>key_string<span class="o">]</span> <span class="o">=</span> data
 <span class="m">21</span>              <span class="k">return</span> normalized_dict
<span class="o">(</span>Pdb<span class="o">)</span> new_key
<span class="s1">'_a_b'</span>
</pre></div>
<p>Our code execution paused on line 10. On line 9 <tt class="docutils literal">new_key</tt> was assigned a value of <tt class="docutils literal">_a_b</tt>, which is what we want to see in the end result.</p>
<p>Look closely at line 13 however and you will note that we aren't just forwarding <tt class="docutils literal">new_key</tt> as an argument to the next <tt class="docutils literal">normalize_json</tt> call. Instead we have an <tt class="docutils literal"><span class="pre">if...else</span></tt> statement that determines which gets forwarded along.  We can evaluate both branches of the conditional to get an idea of what is going on:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> new_key<span class="o">[</span>len<span class="o">(</span>separator<span class="o">)</span> - <span class="m">1</span><span class="o">]</span>
<span class="s1">'_'</span>
<span class="o">(</span>Pdb<span class="o">)</span> new_key<span class="o">[</span>len<span class="o">(</span>separator<span class="o">)</span>:<span class="o">]</span>
<span class="s1">'a_b'</span>
<span class="o">(</span>Pdb<span class="o">)</span> new_key
<span class="s1">'_a_b'</span>
</pre></div>
<p>Our first instinct might be to simplify the function call and make the argument <tt class="docutils literal">key_string=new_key</tt>, making our buggy_script2.py script now look like:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize_json</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">key_string</span><span class="p">,</span>
    <span class="n">normalized_dict</span><span class="p">,</span>
    <span class="n">separator</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key_string</span><span class="si">}{</span><span class="n">separator</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
            <span class="n">normalize_json</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="c1"># to avoid adding the separator to the start of every key</span>
                <span class="n">key_string</span><span class="o">=</span><span class="n">new_key</span><span class="p">,</span>
                <span class="n">normalized_dict</span><span class="o">=</span><span class="n">normalized_dict</span><span class="p">,</span>
                <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalized_dict</span><span class="p">[</span><span class="n">key_string</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">normalized_dict</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">normalize_json</span><span class="p">({</span><span class="s2">"_a"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}},</span> <span class="s2">""</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"_"</span><span class="p">))</span>
</pre></div>
<p>This reads nicer, but we have fixed one thing by breaking another. Doing a <tt class="docutils literal">restart</tt> and <tt class="docutils literal">continue</tt> in no longer hits our breakpoint, but the script now prints out <tt class="docutils literal">{'__a_b': [1, 2, 3]}</tt>. We want <tt class="docutils literal">_a_b</tt> as the key not <tt class="docutils literal">__a_b</tt>.</p>
<p>So back to the drawing board...in pdb input <tt class="docutils literal">restart</tt> and <tt class="docutils literal">clear</tt> to remove the breakpoint we set so far. Enter <tt class="docutils literal">break normalize_json</tt> so we can stop again during every function call.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> clear
Clear all breaks? y
Deleted breakpoint <span class="m">2</span> at /home/willayd/buggy_script2.py:1
<span class="o">(</span>Pdb<span class="o">)</span> <span class="nb">break</span> normalize_json
Breakpoint <span class="m">3</span> at /home/willayd/buggy_script2.py:1
<span class="o">(</span>Pdb<span class="o">)</span>
</pre></div>
<p>Now step through a few function calls, inspect locals and see what might be happening:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">{</span><span class="s1">'_a'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}}</span>, <span class="s1">'key_string'</span>: <span class="s1">''</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span> c
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">{</span><span class="s1">'b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}</span>, <span class="s1">'key_string'</span>: <span class="s1">'__a'</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span> c
&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">7</span><span class="o">)</span>normalize_json<span class="o">()</span>
-&gt; <span class="k">if</span> isinstance<span class="o">(</span>data, dict<span class="o">)</span>:
<span class="o">(</span>Pdb<span class="o">)</span> locals<span class="o">()</span>
<span class="o">{</span><span class="s1">'data'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]</span>, <span class="s1">'key_string'</span>: <span class="s1">'__a_b'</span>, <span class="s1">'normalized_dict'</span>: <span class="o">{}</span>, <span class="s1">'separator'</span>: <span class="s1">'_'</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span>
</pre></div>
<p>If you look closely, you will notice that the <tt class="docutils literal">key_string</tt> variable is already wrong on the second call to the <tt class="docutils literal">normalize_json</tt> function. But the pattern of joining that key with one separator appears correct in the call thereafter.</p>
<p>A simplistic solution is to have some mechanism within our <tt class="docutils literal">normalize_json</tt> call to know if it is the first time the function is being called or not, and special-case the handling of the first call. Inspecting <tt class="docutils literal">locals()</tt> across the different function calls, we notice in the first call that <tt class="docutils literal">key_string</tt> is an empty string but has a value in all subsequent calls. Knowing this we can set up a condition to only strip leading separators if we are NOT in the first function call.</p>
<div class="highlight"><pre><span></span>            normalize_json(
                data=value,
                # to avoid adding the separator to the start of every key
                key_string=new_key,
                normalized_dict=normalized_dict,
                separator=separator,
            )
    else:
        normalized_dict[key_string] = data
    return normalized_dict


if __name__ == "__main__":
    print(normalize_json({"_a": {"b": [1, 2, 3]}}, "", {}, "_"))
</pre></div>
<p>To verify this now works, <tt class="docutils literal">restart</tt> the program, <tt class="docutils literal">clear</tt> any breakpoint(s) and <tt class="docutils literal">continue</tt> to let things run. You should now get the right answer.</p>
<div class="highlight"><pre><span></span><span class="o">(</span>Pdb<span class="o">)</span> restart
Restarting /home/willayd/buggy_script2.py with arguments:

&gt; /home/willayd/buggy_script2.py<span class="o">(</span><span class="m">1</span><span class="o">)</span>&lt;module&gt;<span class="o">()</span>
-&gt; def normalize_json<span class="o">(</span>
<span class="o">(</span>Pdb<span class="o">)</span> clear
Clear all breaks? y
Deleted breakpoint <span class="m">3</span> at /home/willayd/buggy_script2.py:1
<span class="o">(</span>Pdb<span class="o">)</span> c
<span class="o">{</span><span class="s1">'_a_b'</span>: <span class="o">[</span><span class="m">1</span>, <span class="m">2</span>, <span class="m">3</span><span class="o">]}</span>
The program finished and will be restarted
</pre></div>
</div>
<div class="section" id="closing-thoughts">
<h2 id="closing-thoughts">Closing Thoughts</h2>
<p>If you have made it this far congratulations! With modern visual debuggers integrated into IDEs, the way of debugging illustrated above may not be the most commonplace. However, through liberal use of the <tt class="docutils literal">help</tt> command you may find that <tt class="docutils literal">pdb</tt> has many features that are not implemented or obvious to use in higher level debuggers. Barring some differences, you'll also find that this method of using <tt class="docutils literal">pdb</tt> translates well into using <tt class="docutils literal">gdb</tt> and extensions like the Cython debugger, which will be represented in future blog posts.</p>
</div>
<!-- <div class="aspect-w-16 aspect-h-9 mx-auto"></div> CSS placeholder -->
</div>
<footer class="flex flex-col mt-10">
<ul class="flex flex-wrap">
<li class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
<a href="https://willayd.com/tag/python.html">python</a>
</li>
</ul>
<div class="flex w-full my-2 bg-zinc-200 dark:bg-zinc-700 rounded-lg">
<div class="w-1/2 rounded-l-lg"></div>
<div class="w-1/2 hover:bg-zinc-300 dark:hover:bg-zinc-800 rounded-r-lg">
<a class="flex flex-col" href="https://willayd.com/fundamental-python-debugging-part-2-python-extensions.html">
<div class="text-right mx-4 py-2">
<p class="text-zinc-600 dark:text-zinc-300 text-sm">NEXT PAGE »</p>
<p class="text-right py-1 hover:underline">Fundamental Python Debugging Part 2 - Python Extensions</p>
</div>
</a>
</div>
</div>
<div class="flex bg-zinc-200 dark:bg-zinc-700 py-2 rounded-lg justify-center space-x-2 text-xs">
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on twitter" href="https://twitter.com/intent/tweet/?text=Features&amp;url=https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="twitter">
<i aria-hidden="true" class="fab fa-twitter fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="linkedin">
<i aria-hidden="true" class="fab fa-linkedin fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on reddit" href="https://reddit.com/submit?url=https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="reddit">
<i aria-hidden="true" class="fab fa-reddit fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on facebook" href="https://facebook.com/sharer/sharer.php?u=https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="facebook">
<i aria-hidden="true" class="fab fa-facebook fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on whatsapp" href="https://api.whatsapp.com/send?text=Features - https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="whatsapp">
<i aria-hidden="true" class="fab fa-whatsapp fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on telegram" href="https://telegram.me/share/url?text=Features&amp;url=https://willayd.com/fundamental-python-debugging-part-1-python.html" rel="noopener noreferrer" target="_blank" title="telegram">
<i aria-hidden="true" class="fab fa-telegram fa-2x"></i>
</a>
</li>
</ul>
</div>
</footer>
<div>
</div>
</main>
</div>
<footer class="flex w-full text-xs justify-center mt-10 mb-6 text-zinc-600 dark:text-zinc-400">
<div class="px-4">
<span>©2022 • </span>Powered by
            <a class="underline" href="https://getpelican.com/">Pelican</a> &amp;
            <a class="underline" href="https://github.com/aleylara/Papyrus">Papyrus</a>
</div>
</footer>
<script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'G-1FZ91XSPCR', 'auto');
    ga('send', 'pageview');
</script>
<script>
        let themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        let themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
        }
        let themeToggleBtn = document.getElementById('theme-toggle');
        themeToggleBtn.addEventListener('click', function () {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });
    </script>
</body>
</html>