<!DOCTYPE html>

<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1FZ91XSPCR"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1FZ91XSPCR');
    </script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Pelican" name="generator"/>
<meta content="Will Ayd Blog Posts" name="description"/>
<title>Comparing Cython to Rust - Evaluating Python Extensions</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" rel="stylesheet"/>
<link href="https://willayd.com/theme/css/main.css" rel="stylesheet" type="text/css"/>
<link href="https://willayd.com/theme/css/pygment.css" rel="stylesheet" type="text/css"/>
<link href="https://willayd.com/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="https://willayd.com/theme/css/stork.css" rel="stylesheet"/>
<link href="https://willayd.com/theme/css/stork-dark.css" media="screen and (prefers-color-scheme: dark)" rel="stylesheet"/>
<link href="https://willayd.com/css/custom.css" rel="stylesheet"/>
<link href="https://willayd.com/feeds/all.atom.xml" rel="alternate" title="Will Ayd Atom Feed" type="application/atom+xml">
</link><link href="https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Will Ayd", "item": "https://willayd.com"}, {"@type": "ListItem", "position": 2, "name": "Comparing cython to rust evaluating python extensions", "item": "https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Will Ayd"}, "publisher": {"@type": "Organization", "name": "Will Ayd"}, "headline": "Comparing Cython to Rust - Evaluating Python Extensions", "about": "performance", "datePublished": "2023-05-17 00:00", "image": "https://willayd.com/images/og_logo.png"}</script><meta content="summary" name="twitter:card"/><meta content="https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" property="og:url"/><meta content="article" property="og:type"/><meta content="Comparing Cython to Rust - Evaluating Python Extensions" property="og:title"/><meta content='Cython is a tool for Python developers to make low level programming easier. Rust is a language that thinks "Systems Programmers Can Have Nice Things". How do they compare?' property="og:description"/><meta content="https://willayd.com/images/og_logo.png" property="og:image"/><meta content="en_US" property="og:locale"/></head>
<body class="min-h-screen flex flex-col max-w-7xl lg:max-w-none text-zinc-800 bg-neutral-100 dark:bg-neutral-900 dark:text-zinc-300 container mx-auto justify-center md:px-3">
<script>
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
<nav class="sm:flex sm:justify-between xl:ml-32 pl-4 items-center">
<div class="flex pt-4">
<h2 class="font-semibold text-2xl"><a href="https://willayd.com/">Will Ayd</a></h2>
<button aria-label="Light|Dark" class="text-zinc-700 dark:text-zinc-400 rounded-full focus:outline-none text-sm ml-2 p-1" id="theme-toggle" type="button">
<svg class="w-5 h-5 hidden" fill="currentColor" id="theme-toggle-dark-icon" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
</svg>
<svg class="w-5 h-5 hidden" fill="currentColor" id="theme-toggle-light-icon" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd"></path>
</svg>
</button>
</div>
<ul class="flex flex-wrap lg:mr-24 md:pt-0">
<li class="mr-4 pt-6"><a href="https://willayd.com/archives.html">Archive</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/categories.html">Categories</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/tags.html">Tags</a></li>
<li class="mr-4 pt-6"><a href="https://willayd.com/search.html">Search</a></li>
</ul>
</nav>
<div class="flex-grow md:max-w-screen-md md:mx-auto md:w-3/4 px-4">
<nav aria-label="Breadcrumb" class="text-zinc-800 dark:text-zinc-300 mt-12 pb-2 md:mt-16">
<ul class="p-0 inline-flex items-center">
<li class="flex items-center">
<a class="text-zinc-800 dark:text-zinc-300 inline-flex items-center" href="https://willayd.com/">
<svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z">
</path>
</svg>
                        Home
                    </a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
<li class="flex items-center">
<a href="https://willayd.com/categories.html">Categories</a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
<li class="flex items-center">
<a href="https://willayd.com/category/performance.html">performance</a>
<svg class="fill-current w-3 h-3 mr-2 ml-1" viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">
<path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path>
</svg>
</li>
</ul>
</nav>
<main>
<header>
<h1 class="font-semibold text-3xl my-2">Comparing Cython to Rust - Evaluating Python Extensions</h1>
<footer class="flex text-sm text-zinc-800 dark:text-zinc-400">
<div class="flex text-xs text-zinc-800 dark:text-zinc-400">
<time>May 17, 2023</time>
<div>
<span> · 13 min read</span>
</div>
<div>
<span> · Will Ayd</span>
</div>
</div>
</footer>
</header>
<details class="flex flex-col my-6 p-4 bg-zinc-200 dark:bg-zinc-800 rounded-lg">
<summary class="text-lg font-bold">Table of contents</summary>
<div class="mx-4 px-4 underline">
<div id="toc"><ul><li><a class="toc-href" href="#coding-the-example-in-cython" title="Coding the example in Cython">Coding the example in Cython</a></li><li><a class="toc-href" href="#building-the-same-in-rust" title="Building the same in Rust">Building the same in Rust</a></li><li><a class="toc-href" href="#comparing-results" title="Comparing Results">Comparing Results</a></li><li><a class="toc-href" href="#parallelization" title="Parallelization">Parallelization</a></li><li><a class="toc-href" href="#closing-thoughts" title="Closing Thoughts">Closing Thoughts</a></li></ul></div>
</div>
</details>
<div class="max-w-7xl container mx-auto my-8 text-zinc-800 dark:text-zinc-300 prose lg:max-w-none prose-headings:text-zinc-800 prose-headings:dark:text-zinc-300 prose-h1:text-3xl lg:prose-h1:text-3xl prose-headings:font-semibold prose-pre:bg-zinc-200 prose-pre:text-zinc-800 dark:prose-pre:bg-zinc-800 dark:prose-pre:text-zinc-200 prose-blockquote:text-zinc-800 dark:prose-blockquote:text-zinc-200 prose-a:text-slate-600 prose-a:font-normal dark:prose-a:text-slate-400 dark:prose-strong:text-zinc-200 dark:prose-code:text-zinc-200 dark:prose-code:bg-zinc-800 prose-code:bg-zinc-200 prose-code:font-light prose-img:rounded-md sm:text-left md:text-justify">
<p><a class="reference external" href="https://www.rust-lang.org/">Rust</a> as a language has had tremendous growth in recent years. With no intention of starting a language war, Rust has a much stronger type checking system than a language like C, and arguably feels more approachable than a language like C++. It also includes thread safety as part of the language, which can be immensely useful for those looking to optimize their system.</p>
<p>Rust is also growing in usage as an extension language for Python. <a class="reference external" href="https://github.com/PyO3/pyo3">PyO3</a> makes writing extensions relatively easy, especially when compared to the same toolchain(s) for C/C++ extensions. While not as "Pythonic" as Cython, you can argue that Rust is more approachable to Python-developers than C/C++ are as languages. To see it in action, let's compare a Cython written extension to a Rust-written extension.</p>
<p>For demonstration purposes we are taking a trivial example of a custom-implemented <tt class="docutils literal">max</tt> function along the columns of a NumPy array. The example is admittely naive (NumPy natively can handle this), but as a developer you may find yourself following a similar pattern for custom algorithms.</p>
<div class="section" id="coding-the-example-in-cython">
<h2 id="coding-the-example-in-cython">Coding the example in Cython</h2>
<p>Here is our <tt class="docutils literal">find_max</tt> function with a relatively optimized Cython implementation. Within a <tt class="docutils literal">cdef</tt> function, we determine the bounds of a 2D int64 array, loop over the columns / rows and evaluate each member of the array, looking for the largest value in each column.</p>
<div class="highlight"><pre><span></span><span class="n">cimport</span> <span class="n">cython</span>
<span class="kn">from</span> <span class="nn">libc.limits</span> <span class="n">cimport</span> <span class="n">LLONG_MIN</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="n">cimport</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">int64_t</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cdef</span> <span class="n">ndarray</span><span class="p">[</span><span class="n">int64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="n">_find_max</span><span class="p">(</span><span class="n">ndarray</span><span class="p">[</span><span class="n">int64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">]</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">cdef</span><span class="p">:</span>
        <span class="n">ndarray</span><span class="p">[</span><span class="n">int64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="n">out</span>
        <span class="n">int64_t</span> <span class="n">val</span><span class="p">,</span> <span class="n">colnum</span><span class="p">,</span> <span class="n">rownum</span>

    <span class="n">N</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="nb">object</span><span class="o">&gt;</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">colnum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">LLONG_MIN</span>  <span class="c1"># imperfect assumption, but no INT64_T_MIN from numpy</span>
        <span class="k">for</span> <span class="n">rownum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">values</span><span class="p">[</span><span class="n">rownum</span><span class="p">,</span> <span class="n">colnum</span><span class="p">]:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">rownum</span><span class="p">,</span> <span class="n">colnum</span><span class="p">]</span>

        <span class="n">out</span><span class="p">[</span><span class="n">colnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span> <span class="nf">find_max</span><span class="p">(</span><span class="n">ndarray</span><span class="p">[</span><span class="n">int64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">]</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">cdef</span> <span class="n">ndarray</span><span class="p">[</span><span class="n">int64_t</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="n">result</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_find_max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1_000_000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"cypy took </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> milliseconds"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>For brevity I won't be listing out the instructions to cythonize and build a shared library, but if you need you can follow similar instructions from the previous article on <a class="reference external" href="https://willayd.com/fundamental-python-debugging-part-3-cython-extensions.html">debugging Cython extensions with gdb</a>. For this article, assume that this gets built to a shared library named <cite>cypy</cite>.</p>
</div>
<div class="section" id="building-the-same-in-rust">
<h2 id="building-the-same-in-rust">Building the same in Rust</h2>
<p>PyO3 will be our tool for setting up Rust &lt;&gt; Python interoperability. Per their <a class="reference external" href="https://pyo3.rs/v0.18.3/module">documentation on building modules</a> we could choose to build manually or use <a class="reference external" href="https://github.com/PyO3/maturin">maturin</a>. For ease of demonstration we will use the latter.</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; maturin new rustpy
&gt;&gt;&gt; <span class="nb">cd</span> rustpy
</pre></div>
<p>Within our newly created project, add <tt class="docutils literal">numpy == "0.18"</tt> to the dependencies section. This will let us use the <a class="reference external" href="https://github.com/PyO3/rust-numpy">rust-numpy</a> crate to pass numpy arrows between Python and Rust. Afterwards, open <cite>lib.rs</cite> an insert the following code:</p>
<div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">numpy</span>::<span class="n">ndarray</span>::<span class="p">{</span><span class="n">Array1</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayView2</span><span class="p">,</span><span class="w"> </span><span class="n">Axis</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">numpy</span>::<span class="p">{</span><span class="n">PyArray1</span><span class="p">,</span><span class="w"> </span><span class="n">PyReadonlyArray2</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">pyo3</span>::<span class="p">{</span><span class="n">pymodule</span><span class="p">,</span><span class="w"> </span><span class="n">types</span>::<span class="n">PyModule</span><span class="p">,</span><span class="w"> </span><span class="n">PyResult</span><span class="p">,</span><span class="w"> </span><span class="n">Python</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">time</span>::<span class="n">SystemTime</span><span class="p">;</span><span class="w"></span>

<span class="cp">#[pymodule]</span><span class="w"></span>
<span class="cp">#[pyo3(name = </span><span class="s">"rustpy"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">rust_ext</span><span class="p">(</span><span class="n">_py</span>: <span class="nc">Python</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span>: <span class="kp">&amp;</span><span class="nc">PyModule</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">PyResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">find_max</span><span class="p">(</span><span class="n">arr</span>: <span class="nc">ArrayView2</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Array1</span><span class="o">&lt;</span><span class="kt">i64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array1</span>::<span class="n">default</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">ncols</span><span class="p">());</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">arr</span><span class="p">.</span><span class="n">axis_iter</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i64</span>::<span class="n">MIN</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">out</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cp">#[pyfn(m)]</span><span class="w"></span>
<span class="w">    </span><span class="cp">#[pyo3(name = </span><span class="s">"find_max"</span><span class="cp">)]</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">find_max_py</span><span class="o">&lt;'</span><span class="na">py</span><span class="o">&gt;</span><span class="p">(</span><span class="n">py</span>: <span class="nc">Python</span><span class="o">&lt;'</span><span class="na">py</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span>: <span class="nc">PyReadonlyArray2</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">py</span> <span class="nc">PyArray1</span><span class="o">&lt;</span><span class="kt">i64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SystemTime</span>::<span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_max</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">as_array</span><span class="p">()).</span><span class="n">into_pyarray</span><span class="p">(</span><span class="n">py</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SystemTime</span>::<span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">duration_since</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"rustpy took {} milliseconds"</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="p">.</span><span class="n">as_millis</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Studying the above closely, the <tt class="docutils literal">find_max_py</tt> function is the bridge between Rust and Python, and it ultimately dispatches to the <tt class="docutils literal">find_max</tt> function. That function accepts a 2 dimensional view of an array, and returns a newly created 1D array full of 64 bit integers. Within the function body, you see the dynamic creation of the return value, as well as iteration by column. While the semantics vary, you should see that this follows the same general outline as our Cython implementation.</p>
<p>With this in place, run <tt class="docutils literal">maturin develop <span class="pre">--release</span></tt> from the project root. This will take care of installing the local source code into a Python package with optimizations.</p>
</div>
<div class="section" id="comparing-results">
<h2 id="comparing-results">Comparing Results</h2>
<p>Both implementations above include not-very-scientific timers to give us an idea of general performance. Let's set up with the following code:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100_000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1_000_000</span><span class="p">))</span>
</pre></div>
<p>Let's check our cypy performance:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">cypy</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">cypy</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">cypy</span> <span class="n">took</span> <span class="mf">289.319301</span> <span class="n">milliseconds</span>
</pre></div>
<p>Versus the same function implemented in Rust:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">rustpy</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">rustpy</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">rustpy</span> <span class="n">took</span> <span class="mi">116</span> <span class="n">milliseconds</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">result1</span> <span class="o">==</span> <span class="n">result2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="kc">True</span>
</pre></div>
<p>The rust implementation only took ~40% of the time - not bad!</p>
</div>
<div class="section" id="parallelization">
<h2 id="parallelization">Parallelization</h2>
<p>Another area where Rust extensions can really shine is in parallelization, due to the aforementioned language guarantees of thread safety. Cython offers <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/parallelism.html">parallelization</a> using OpenMP, but as <a class="reference external" href="https://github.com/pandas-dev/pandas/pull/53149">I recently discovered</a> there are quite a few downsides to that when it comes to packaging, usability and cross-platform behavior.</p>
<p>Since Rust handles this more natively, let's see how it would tackle the above code but in a parallel way. For this purpose we are going to use the <a class="reference external" href="https://docs.rs/rayon/latest/rayon/">rayon</a> feature that comes bundled with the <a class="reference external" href="https://docs.rs/ndarray/latest/ndarray/">Rust ndarray crate</a>. To enable that, go ahead and add <tt class="docutils literal">ndarray = {version = "0.15", <span class="pre">features=["rayon"]}</span></tt> to your dependencies in <cite>Cargo.toml</cite>.</p>
<p>Afterwards we are going to add 2 new functions to our <cite>rustpy</cite> library - one to handle the internals and the other to serve as the bridge to Python. For starters, let us update the imports at the top of our module:</p>
<div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">ndarray</span>::<span class="n">parallel</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">numpy</span>::<span class="n">ndarray</span>::<span class="p">{</span><span class="n">Array1</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayView2</span><span class="p">,</span><span class="w"> </span><span class="n">Axis</span><span class="p">,</span><span class="w"> </span><span class="n">Zip</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">numpy</span>::<span class="p">{</span><span class="n">IntoPyArray</span><span class="p">,</span><span class="w"> </span><span class="n">PyArray1</span><span class="p">,</span><span class="w"> </span><span class="n">PyReadonlyArray2</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">pyo3</span>::<span class="p">{</span><span class="n">pymodule</span><span class="p">,</span><span class="w"> </span><span class="n">types</span>::<span class="n">PyModule</span><span class="p">,</span><span class="w"> </span><span class="n">PyResult</span><span class="p">,</span><span class="w"> </span><span class="n">Python</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="p">{</span><span class="n">Arc</span><span class="p">,</span><span class="w"> </span><span class="n">Mutex</span><span class="p">};</span><span class="w"></span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">time</span>::<span class="n">SystemTime</span><span class="p">;</span><span class="w"></span>
</pre></div>
<p>Then go ahead and all the following code below the <tt class="docutils literal">find_max_py</tt> function.</p>
<div class="highlight"><pre><span></span><span class="k">fn</span> <span class="nf">find_max_parallel</span><span class="p">(</span><span class="n">arr</span>: <span class="nc">ArrayView2</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Array1</span><span class="o">&lt;</span><span class="kt">i64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span>::<span class="n">new</span><span class="p">(</span><span class="n">Mutex</span>::<span class="n">new</span><span class="p">(</span><span class="n">Array1</span>::<span class="n">default</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">ncols</span><span class="p">())));</span><span class="w"></span>

<span class="w">    </span><span class="c1">// parallel iterator is not implemented, so some hacks</span>
<span class="w">    </span><span class="c1">// https://github.com/rust-ndarray/ndarray/issues/1043</span>
<span class="w">    </span><span class="c1">// https://github.com/rust-ndarray/ndarray/issues/1093</span>
<span class="w">    </span><span class="n">Zip</span>::<span class="n">indexed</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">axis_iter</span><span class="p">(</span><span class="n">Axis</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">into_par_iter</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">for_each</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i64</span>::<span class="n">MIN</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutex</span><span class="p">.</span><span class="n">lock</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">guard</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">});</span><span class="w"></span>

<span class="w">    </span><span class="c1">// https://stackoverflow.com/questions/29177449/how-to-take-ownership-of-t-from-arcmutext</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span>::<span class="n">try_unwrap</span><span class="p">(</span><span class="n">mutex</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">"Lock still have multiple owners"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">lock</span><span class="p">.</span><span class="n">into_inner</span><span class="p">().</span><span class="n">expect</span><span class="p">(</span><span class="s">"Mutex cannot be locked"</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// wrapper of `find_max`</span>
<span class="cp">#[pyfn(m)]</span><span class="w"></span>
<span class="cp">#[pyo3(name = </span><span class="s">"find_max_parallel"</span><span class="cp">)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">find_max_py_parallel</span><span class="o">&lt;'</span><span class="na">py</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">py</span>: <span class="nc">Python</span><span class="o">&lt;'</span><span class="na">py</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span>: <span class="nc">PyReadonlyArray2</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="o">'</span><span class="na">py</span> <span class="nc">PyArray1</span><span class="o">&lt;</span><span class="kt">i64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SystemTime</span>::<span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find_max_parallel</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">as_array</span><span class="p">()).</span><span class="n">into_pyarray</span><span class="p">(</span><span class="n">py</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SystemTime</span>::<span class="n">now</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">.</span><span class="n">duration_since</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"rustpy parallel took {} milliseconds"</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="p">.</span><span class="n">as_millis</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">result</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Within the comments I've linked some StackOverflow articles that you may find of interest. At a high level, now that we want to execute things in parallel we need to implement a <a class="reference external" href="https://doc.rust-lang.org/std/sync/struct.Mutex.html">Mutex</a> to prevent data races. We also use an automatic reference counter <a class="reference external" href="https://doc.rust-lang.org/std/sync/struct.Arc.html">Arc</a>, which is a common way for sharing things across thread.</p>
<p>So how does this compare performance-wise to our examples above?</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">rustpy</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result3</span> <span class="o">=</span> <span class="n">rustpy</span><span class="o">.</span><span class="n">find_max_parallel</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="n">rustpy</span> <span class="n">took</span> <span class="mi">234</span> <span class="n">milliseconds</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">result2</span> <span class="o">==</span> <span class="n">result3</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="kc">True</span>
</pre></div>
<p>We get the same results which is great, but compared to the non-parallel implementation we are now slower - almost twice as slow. What gives?!?</p>
<p>Without peering into every detail, it goes without saying that there is "no such thing as a free lunch". Using the mutex to synchronize parallel code above is no exception, and likely the cost of that synchronization far exceeds the benefit of it. Keep in mind that we are dealing with an array of 100 x 1_000_000 and attempting to synchronize a thread per column. That's a lot of threads to operate on rows of 100 records!</p>
<p>What happens if we transpose the array?</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">arr2</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">arr2</span><span class="o">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">1000000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rustpy</span><span class="o">.</span><span class="n">find_max</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
<span class="n">rustpy</span> <span class="n">took</span> <span class="mi">67</span> <span class="n">milliseconds</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rustpy</span><span class="o">.</span><span class="n">find_max_parallel</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
<span class="n">rustpy</span> <span class="n">took</span> <span class="mi">38</span> <span class="n">milliseconds</span>
</pre></div>
<p>That's more like it! Whereas before we created 1_000_000 threads to operate on arrays of 100 records, now we use 100 threads to operate on arrays of 1_000_000 records. The relative cost of starting / stopping threads and synchronizing access via the mutex in this case is far lower than the relative performance gain we get from allowing threads to operate on large arrays in parallel.</p>
</div>
<div class="section" id="closing-thoughts">
<h2 id="closing-thoughts">Closing Thoughts</h2>
<p>From my initial trials I was very surprised by how good Rust was for building extensions. The language itself is pretty natural in a way that I think could be useful to higher-level programmers, while offering great performance at the same time. Not pictured in the above analysis were a ton of mistakes in trying to get code parallelized via Rust. In C/C++ I likely would have made a very buggy program; the Rust compiler prevented me from doing so here. In all, I think Rust can creep into the same realm that Cython occupies today and become a serious competitor for easy extension authoring.</p>
</div>
<!-- <div class="aspect-w-16 aspect-h-9 mx-auto"></div> CSS placeholder -->
</div>
<footer class="flex flex-col mt-10">
<ul class="flex flex-wrap">
<li class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
<a href="https://willayd.com/tag/cython.html">cython</a>
</li>
<li class="bg-zinc-200 hover:bg-zinc-300 dark:hover:bg-zinc-800 dark:bg-zinc-700 text-zinc-600 dark:text-zinc-300 mb-2 mr-2 px-3 py-1.5 rounded-md transition ease-in active:-translate-y-1 active:scale-110 duration-75">
<a href="https://willayd.com/tag/python.html">python</a>
</li>
</ul>
<div class="flex w-full my-2 bg-zinc-200 dark:bg-zinc-700 rounded-lg">
<div class="w-1/2 hover:bg-zinc-300 dark:hover:bg-zinc-800 rounded-l-lg">
<a class="flex flex-col pr-2" href="https://willayd.com/profiling-python-extensions-with-callgrind.html">
<div class="mx-4 py-2 text-left">
<p class="text-zinc-600 dark:text-zinc-300 text-sm">« PREV PAGE</p>
<p class="text-left py-1 hover:underline">Profiling Python Extensions with callgrind</p>
</div>
</a>
</div>
</div>
<div class="flex bg-zinc-200 dark:bg-zinc-700 py-2 rounded-lg justify-center space-x-2 text-xs">
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on twitter" href="https://twitter.com/intent/tweet/?text=Features&amp;url=https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="twitter">
<i aria-hidden="true" class="fab fa-twitter fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url=https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="linkedin">
<i aria-hidden="true" class="fab fa-linkedin fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on reddit" href="https://reddit.com/submit?url=https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="reddit">
<i aria-hidden="true" class="fab fa-reddit fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on facebook" href="https://facebook.com/sharer/sharer.php?u=https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="facebook">
<i aria-hidden="true" class="fab fa-facebook fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on whatsapp" href="https://api.whatsapp.com/send?text=Features - https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="whatsapp">
<i aria-hidden="true" class="fab fa-whatsapp fa-2x"></i>
</a>
</li>
</ul>
<ul>
<li class="bg-gray-900 p-1 text-white rounded-md">
<a aria-label="share Features on telegram" href="https://telegram.me/share/url?text=Features&amp;url=https://willayd.com/comparing-cython-to-rust-evaluating-python-extensions.html" rel="noopener noreferrer" target="_blank" title="telegram">
<i aria-hidden="true" class="fab fa-telegram fa-2x"></i>
</a>
</li>
</ul>
</div>
</footer>
<div>
</div>
</main>
</div>
<footer class="flex w-full text-xs justify-center mt-10 mb-6 text-zinc-600 dark:text-zinc-400">
<div class="px-4">
<span>©2022 • </span>Powered by
            <a class="underline" href="https://getpelican.com/">Pelican</a> &amp;
            <a class="underline" href="https://github.com/aleylara/Papyrus">Papyrus</a>
</div>
</footer>
<script type="text/javascript">
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'G-1FZ91XSPCR', 'auto');
    ga('send', 'pageview');
</script>
<script>
        let themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        let themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia(
                '(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
        }
        let themeToggleBtn = document.getElementById('theme-toggle');
        themeToggleBtn.addEventListener('click', function () {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });
    </script>
</body>
</html>